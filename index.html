<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" href="assets/style.css" />

<head>
  <meta charset="UTF-8" />
  <title>The Satoshi Faucet - Free Satoshis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description"
    content="The Satoshi Faucet - a nostalgic tribute faucet giving away a few satoshis to keep the legacy alive." />
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>

</head>

<body>
  <div class="page">
    <header>
      <!-- Tap graphic (replace tap.png with your actual file) -->
      <img src="tap.png" alt="Faucet" class="tap-image" />

      <div class="logo-area">
        <div class="faucet-icon" aria-hidden="true"></div>
        <div>
          <h1>The Satoshi Faucet</h1>
          <div class="subtitle">A tribute to the original Bitcoin Faucet ‚Äì now dripping satoshis.</div>
        </div>
      </div>
    </header>

    <div class="layout">
      <!-- Left column / sidebar -->
      <aside class="sidebar">
        <h2>Balance</h2>
        <div class="sidebar-value" id="available-balance">‚ñ≤ 75&nbsp;000 satoshis available</div>
        <h2>Other Sites</h2>
        <ul>
          <li><a href="https://bitcointalk.org" target="_blank" rel="noopener noreferrer">bitcointalk.org</a></li>
          <li><a href="https://bitcoin.org" target="_blank" rel="noopener noreferrer">bitcoin.org</a></li>
          <li><a href="https://en.bitcoin.it/wiki/Main_Page" target="_blank" rel="noopener noreferrer">Bitcoin Wiki</a>
          </li>
        </ul>

        <!-- MINI DASHBOARD -->
        <section class="recent-activity">
          <h2>Recent Activity</h2>
          <div class="recent-activity-box">
            <div class="recent-activity-header">
              <span class="recent-head-id">ID</span>
              <span class="recent-head-invoice">Invoice</span>
              <span class="recent-head-status">Status</span>
              <span class="recent-head-time">Time</span>
            </div>

            <ul id="recent-activity-items" class="recent-activity-list">
              <!-- JS fills rows here -->
            </ul>
          </div>
          <div class="recent-activity-footer">
            <a href="faucet-status.php">View full status &rarr;</a>
          </div>
        </section>

      </aside>

      <!-- Main content -->
      <main>
        <div class="faucet-panel">
          <div class="faucet-panel-title">Get Satoshis from the Satoshi Faucet</div>
          <p class="faucet-panel-text">
            I‚Äôm giving away a few satoshis per visitor. Just complete the reCAPTCHA, enter your Lightning or Bitcoin
            receiving address, and press <strong>Get Some!</strong>
          </p>

          <form id="faucet-form" autocomplete="off">
            <div class="captcha-wrap">
              <div class="captcha-note">
                We offer free sats only to humans and aliens but not robots.<br>
                Please prove you're not an AI robot by completing the reCAPTCHA below.
              </div>
              <!-- Google reCAPTCHA -->
              <div class="g-recaptcha" data-sitekey="6LfFKSEsAAAAAKBqHR-UMEAQppJZ58vzoY4R_qb_"></div>
            </div>

            <div class="address-row">
              <label for="address-input">Your Satoshi Address:</label>
              <input id="address-input" name="address" type="text"
                placeholder="Lightning invoice (starting with lnbc...)" />
              <button type="submit" class="btn-primary" id="get-button">Get Some!</button>
            </div>
            <p style="font-size:0.85rem;margin-top:6px;">
              Need help? <a href="how-to-create-lightning-invoice-steps.html" target="_blank" rel="noopener">How to
                create a
                Lightning invoice</a>
            </p>

            <div class="status-message" id="status-message" aria-live="polite"></div>
          </form>

        </div>

        <!-- Informational sections -->
        <section>
          <h2>What are Satoshis?</h2>
          <p>
            Satoshis (or ‚Äúsats‚Äù) are the smallest unit of bitcoin. One bitcoin equals 100&nbsp;000&nbsp;000 satoshis.
            Just like cents are to dollars, sats let you send tiny pieces of bitcoin around the world.
          </p>
          <p>
            Bitcoin itself is a new kind of money. It isn‚Äôt created or controlled by any single government or company.
            It runs on a peer-to-peer network secured by cryptography.
          </p>
        </section>

        <section>
          <h2>How do I get a receiving address?</h2>
          <p>
            Download a Bitcoin or Lightning wallet (for example from
            <a href="https://bitcoin.org/en/choose-your-wallet" target="_blank"
              rel="noopener noreferrer">bitcoin.org</a>).
            Your wallet will show you a receiving address or invoice you can paste here.
          </p>
        </section>

        <section>
          <h2>I‚Äôve got sats ‚Äì how can I help?</h2>
          <p>
            This faucet is just for fun and nostalgia. If you want to keep it flowing, you can donate a little bitcoin
            to its on-chain or Lightning address (to be listed here once the backend is live).
          </p>
        </section>

        <section>
          <h2>What‚Äôs the catch?</h2>
          <p>
            No catch ‚Äì I just want to keep the spirit of the original Bitcoin Faucet alive and give newcomers a tiny
            taste of sats to start with.
          </p>
        </section>

        <footer>
          Still just a simple faucet on the internet. No guarantees, no promises. Use at your own risk.
          <br />
          <a href="faucet-status.php" style="font-size:0.85rem;">View faucet status &amp; recent activity</a>
          | <a href="dear-hackers.html" style="font-size:0.8rem;">A friendly message to hackers</a>
        </footer>
      </main>
    </div>
  </div>

  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <script>
    (function () {
      const form = document.getElementById("faucet-form");
      const addressEl = document.getElementById("address-input");
      const statusEl = document.getElementById("status-message");
      const getBtn = document.getElementById("get-button");

      form.addEventListener("submit", function (e) {
        e.preventDefault();
        statusEl.textContent = "";
        statusEl.className = "status-message";

        const invoice = addressEl.value.trim();
        if (!invoice) {
          statusEl.textContent = "Please paste a Lightning invoice (BOLT11).";
          statusEl.classList.add("status-error");
          return;
        }

        let captchaResponse = "";
        if (window.grecaptcha) {
          captchaResponse = grecaptcha.getResponse();
        }
        if (!captchaResponse) {
          statusEl.textContent = "Please complete the reCAPTCHA before claiming.";
          statusEl.classList.add("status-error");
          return;
        }

        getBtn.disabled = true;

        const formData = new FormData();
        formData.append("address", invoice);
        formData.append("g-recaptcha-response", captchaResponse);

        fetch("claim.php", {
          method: "POST",
          body: formData
        })
          .then(r => r.json())
          .then(data => {
            if (data.status === "queued") {
              statusEl.textContent = data.message + " (Invoice: " + data.invoice + ")";
              statusEl.classList.add("status-success");
              window.refreshRecentActivity(); // refresh recent activity list
            } else if (data.status === "already_claimed") {
              statusEl.textContent = data.message + " (Invoice: " + data.invoice + ")";
              statusEl.classList.add("status-error");
            } else {
              statusEl.textContent = data.message || "Something went wrong. Please try again.";
              statusEl.textContent += " (Error: " + data.debug + ")";
              statusEl.classList.add("status-error");
            }
          })
          .catch(err => {
            console.error(err);
            statusEl.textContent = "Network error. Please try again.";
            statusEl.classList.add("status-error");
          })
          .finally(() => {
            getBtn.disabled = false;
            if (window.grecaptcha) {
              grecaptcha.reset();
            }
          });
      });
    })();
  </script>

  <script>
    (function () {
      const listEl = document.getElementById("recent-activity-items");
      if (!listEl) return;

      function renderItems(items) {
        listEl.innerHTML = "";

        if (!items || !items.length) {
          const li = document.createElement("li");
          li.className = "recent-activity-item";
          li.innerHTML =
            '<div class="recent-col-id">‚Äì</div>' +
            '<div class="recent-col-invoice">No activity yet.</div>' +
            '<div class="recent-col-status"></div>' +
            '<div class="recent-col-time"></div>';
          listEl.appendChild(li);
          return;
        }

        items.forEach(function (item) {
          const li = document.createElement("li");
          li.className = "recent-activity-item";

          // Col 1: ID
          const colId = document.createElement("div");
          colId.className = "recent-col-id";
          colId.textContent = item.id;

          // Col 2: invoice pill (short text, full in tooltip)
          const colInvoice = document.createElement("div");
          colInvoice.className = "recent-col-invoice";
          const pill = document.createElement("span");
          pill.className = "recent-invoice-pill";
          pill.title = item.invoiceFull || ""; // full invoice on mouseover

          const icon = document.createElement("span");
          icon.className = "recent-invoice-icon";
          icon.textContent = "‚ö°";

          const text = document.createElement("span");
          text.textContent = item.invoiceShort || "ln‚Ä¶";

          pill.appendChild(icon);
          pill.appendChild(text);
          colInvoice.appendChild(pill);

          // Col 3: status pill
          const colStatus = document.createElement("div");
          colStatus.className = "recent-col-status";

          const statusPill = document.createElement("span");
          const key = (item.statusKey || "").toLowerCase();
          let cssKey = key;
          if (key === "pending" || key === "processing") cssKey = "pending";
          if (key === "failed" || key === "blocked") cssKey = "failed";

          statusPill.className = "recent-status-pill recent-status-" + cssKey;

          const statusIcon = document.createElement("span");
          if (key === "paid") statusIcon.textContent = "‚úÖ";
          else if (key === "failed" || key === "blocked") statusIcon.textContent = "‚ö†Ô∏è";
          else statusIcon.textContent = "‚è≥";

          const statusText = document.createElement("span");
          statusText.textContent = item.status || "";

          statusPill.appendChild(statusIcon);
          statusPill.appendChild(statusText);
          colStatus.appendChild(statusPill);

          // Col 4: clock icon with tooltip = last updated
          const colTime = document.createElement("div");
          colTime.className = "recent-col-time";
          const timeSpan = document.createElement("span");
          timeSpan.className = "recent-time-icon";
          timeSpan.textContent = "üïí";

          const lastTime = item.updatedAt || item.createdAt || "";
          timeSpan.title = lastTime
            ? "Last update: " + lastTime + " UTC"
            : "No timestamp";

          colTime.appendChild(timeSpan);

          li.appendChild(colId);
          li.appendChild(colInvoice);
          li.appendChild(colStatus);
          li.appendChild(colTime);
          listEl.appendChild(li);
        });
      }

      window.refreshRecentActivity = function () {
        fetch("recent-activity.php", { cache: "no-store" })
          .then(function (res) { return res.json(); })
          .then(function (data) {
            renderItems(data.items || []);
          })
          .catch(function () {
            // You can log errors if you want
          });
      };

      // Initial load + poll
      window.refreshRecentActivity();
      setInterval(window.refreshRecentActivity, 6000); // every 6 seconds
    })();
  </script>

</body>

</html>